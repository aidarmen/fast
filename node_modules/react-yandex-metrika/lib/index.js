/* eslint-env browser */
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.YMInitializer = undefined;

var _component = require('./component');

Object.defineProperty(exports, 'YMInitializer', {
    enumerable: true,
    get: function get() {
        return _component.YMInitializer;
    }
});

var _constants = require('./constants');

var isBrowser = typeof window !== 'undefined';

function ymProxy(id, methodName) {
    try {
        var _window$trackerInstan;

        for (var _len = arguments.length, args = Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {
            args[_key - 2] = arguments[_key];
        }

        (_window$trackerInstan = window[(0, _constants.trackerInstanceName)(id)])[methodName].apply(_window$trackerInstan, args);
    } catch (ex) {
        console.warn(ex);
    }
}

function ymAsyncProxy() {
    for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
        args[_key2] = arguments[_key2];
    }

    window[_constants.accountListName].forEach(function (id) {
        var trackerVersion = window[(0, _constants.trackerVersionName)(id)];
        var callbackQueue = window[(0, _constants.callbackQueueName)(trackerVersion)];
        if (callbackQueue) {
            callbackQueue.push(function () {
                return ymProxy.apply(undefined, [id].concat(args));
            });
        } else {
            ymProxy.apply(undefined, [id].concat(args));
        }
    });
}

function ym() {
    if (isBrowser) {
        ymAsyncProxy.apply(undefined, arguments);
    }
}

exports.default = ym;
